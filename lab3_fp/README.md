# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ3 (Interpolation processes)

---

* –°—Ç—É–¥–µ–Ω—Ç: `–ï—Ñ–∏–º–æ–≤ –ê—Ä—Å–ª–∞–Ω –ê–ª—å–±–µ—Ä—Ç–æ–≤–∏—á`
* –ì—Ä—É–ø–ø–∞: `P3332`
* –ò–°–£: `368162`
* –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —è–∑—ã–∫: `Erlangüî•üî•üî•`

--- 

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

–¶–µ–ª—å: –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–≤—ã–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –≤–≤–æ–¥–æ–º/–≤—ã–≤–æ–¥–æ–º, –ø–æ—Ç–æ–∫–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–∞–Ω–Ω—ã—Ö, –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π.

–í —Ä–∞–º–∫–∞—Ö –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤–∞–º –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—É—é —Ä–∞–±–æ—Ç—É –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É "–í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞" –ø–æ—Å–≤—è—â—ë–Ω–Ω—É—é –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ (–≤ —Ä–∞–∑–Ω—ã–µ –≥–æ–¥—ã —ç—Ç–æ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 3 –∏–ª–∏ 4) —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è–º–∏:

- –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ª–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è (–æ—Ç—Ä–µ–∑–∫–∞–º–∏, link);
- –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –∏ –≤—ã–≤–æ–¥–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω—ã –∑–∞–¥–∞–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏:

    - –∫–∞–∫–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (–≤ —Ç–æ–º —á–∏—Å–ª–µ –¥–≤–∞ —Å—Ä–∞–∑—É);
    - —á–∞—Å—Ç–æ—Ç–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö;
    - –∏ —Ç.–ø.;

- –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –∑–∞–¥–∞–≤–∞—Ç—å—Å—è –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –Ω–∞ –ø–æ–¥–æ–±–∏–∏ ".csv" (–∫ –ø—Ä–∏–º–µ—Ä—É x;y\n –∏–ª–∏ x\ty\n) –∏ –ø–æ–¥–∞–≤–∞—Ç—å—Å—è –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–≤–æ–¥, –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é x;
- –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –ø–æ–¥–∞–≤–∞—Ç—å—Å—è –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥;
- –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –ø–æ—Ç–æ–∫–æ–≤–æ–º —Ä–µ–∂–∏–º–µ (–ø—Ä–∏–º–µ—Ä -- cat | grep 11), —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –æ–∂–∏–¥–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–≤–æ–¥, –∏, –ø–æ –º–µ—Ä–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö, –¥–æ–ª–∂–Ω–∞ –≤—ã–≤–æ–¥–∏—Ç—å —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ —Ç–æ—á–∫–∏ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥;


–í —Ä–∞–º–∫–∞—Ö –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ 2 –≤–∞—Ä–∏–Ω–∞—Ç–∞:

- –°–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –≤ Erlang
- –° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `OTP`

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:

#### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã:

- –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É: [main](processes/src/main.erl)
- –ú–æ–¥—É–ª—å –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞: [io_module](processes/src/io_module.erl)
- –ú–æ–¥—É–ª—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–π: [interoplations](processes/src/interpolations.erl)
- –õ–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è: [linear_interpolation](processes/src/linear_interpolation.erl)
- –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –õ–∞–≥—Ä–∞–Ω–∂–∞: [lagrange_interpolation](processes/src/lagrange_interpolation.erl)

#### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:

`data -> io_modile (input) -> interpolations -> (linear or lagrange) -> interpolations (results) -> io_module (output) -> result `

### –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

**–õ–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è:**

````erlang
start_linear(Step, From) ->
  spawn(fun() -> linear_loop([], Step, From) end).

linear_interpolation(Step, [[X1, Y1], [X2, Y2]]) ->
  case X1 =:= X2 of
    true ->
      {error, linear};
    false ->
      K = (Y2 - Y1) / (X2 - X1),
      B = Y1 - K * X1,
      GenerateValues = interpolations:points_generator(Step, X1, X2),
      Res = [GenerateValues, lists:map(fun(X) -> K * X + B end, GenerateValues)],
      {ok, linear, Res}
  end.

linear_loop(Points, Step, From) ->
  receive
    {data, Data} ->
      UpdatedPoints =
        case Points of
          [_ | Rest] when length(Points) == 2 -> Rest ++ [Data];
          _ -> Points ++ [Data]
        end,
      case length(UpdatedPoints) of
        2 ->
          % [P1, P2] = UpdatedPoints,
          Sorted = lists:sort(fun([A, _], [B, _]) -> A =< B end, UpdatedPoints),
          Result = linear_interpolation(Step, Sorted),
          case Result of
            {ok, linear, Res} -> From ! {ok, linear, Res};
            _ -> From ! {error, linear}
          end,
          linear_loop(UpdatedPoints, Step, From);
        _ ->
          linear_loop(UpdatedPoints, Step, From)
      end
  end.
````

–§—É–Ω–∫—Ü–∏—è start_linear —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∞–º–∞ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –º–æ–¥—É–ª—å –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–π

**–ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –õ–∞–≥—Ä–∞–Ω–∂–∞**
```erlang
start_lagrange(From, Step, Window) ->
  spawn(fun() -> lagrange_loop([], Step, Window, From) end).

lagrange_multiplier(X, Xi, Points) ->
  lists:foldl(
    fun
      ([Xj, _], Acc) when Xj =/= Xi ->
        Acc * (X - Xj) / (Xi - Xj);
      (_, Acc) ->
        Acc
    end,
    1,
    Points
  ).
lagrange_polynomial(X, Points) ->
  lists:foldl(
    fun([Xi, Yi], Acc) ->
      Acc + Yi * lagrange_multiplier(X, Xi, Points)
    end,
    0,
    Points
  ).
evaluate_lagrange(Step, Points) ->
  [X1, _] = hd(Points),
  [X2, _] = lists:last(Points),
  GeneratedDots = interpolations:points_generator(Step, X1, X2),
  [GeneratedDots, [lagrange_polynomial(X, Points) || X <- GeneratedDots]].

lagrange_loop(Points, Step, Window, From) ->
  receive
    {data, Data} ->
      UpdatedPoints =
        case length(Points) of
          Window ->
            tl(Points) ++ [Data];
          _ ->
            Points ++ [Data]
        end,

      case length(UpdatedPoints) of
        Window ->
          Sorted = lists:sort(fun([A, _], [B, _]) -> A =< B end, UpdatedPoints),
          InterpolatedValues = evaluate_lagrange(Step, Sorted),
          From ! {ok, lagrange, InterpolatedValues};
        _ ->
          lagrange_loop(UpdatedPoints, Step, Window, From)
      end,

      lagrange_loop(UpdatedPoints, Step, Window, From);
    _ ->
      lagrange_loop(Points, Step, Window, From)
  end.
```

–¢–∞ –∂–µ –ª–æ–≥–∏–∫–∞, —á—Ç–æ –∏ –≤ –ª–∏–Ω–µ–π–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏

**–ú–æ–¥—É–ª—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–π:**

```erlang
start(InitialValues) ->
  register(interpolationpid, self()),
  init(InitialValues).


init(InitialValues) ->
  Methods = element(3, InitialValues),

  Procs = lists:map(
    fun(X) ->
      case X of
        linear ->
          Pid = linear_interpolation:start_linear(element(1, InitialValues), self()),
          {Pid, linear};
        lagrange ->
          Pid = lagrange_interpolation:start_lagrange(
            self(), element(1, InitialValues), element(2, InitialValues)
          ),
          {Pid, lagrange};
        Method ->
          io:fwrite("–ù–µ–∑–Ω–∞–∫–æ–º—ã–π –º–µ—Ç–æ–¥: ~p, –ø—Ä–æ–ø—É—â–µ–Ω~n", [Method]),
          undefined
      end
    end,
    Methods
  ),

  ValidProcs = lists:filter(fun(X) -> X =/= undefined end, Procs),
  interpolation_loop(ValidProcs, InitialValues).


interpolation_loop(Procs, InitialValues) ->
  receive
  
    {interpolate, Data} ->
      [Pid ! {data, Data} || {Pid, _} <- Procs],
      interpolation_loop(Procs, InitialValues);

  
    {ok, Method, Result} ->
      opid ! {ok, Method, Result},
      interpolation_loop(Procs, InitialValues);

  
    {error, Method} ->
      opid ! {error, Method, "–ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å –Ω–µ—É–¥–∞—á–µ–π"},
      interpolation_loop(Procs, InitialValues)
  end.

```

### –í–≤–æ–¥/–í—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã:

–ù–∞–π–¥–µ–º —Ç–æ—á–∫–∏ –¥–ª—è –ª–∏–Ω–µ–π–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –∏ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –ª–∞–≥—Ä–∞–Ω–∂–∞, –≥–¥–µ:

- Frequency - 0.5
- Windows - 4

–î–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ ln(x):

```text
–í–≤–µ–¥–∏—Ç–µ —Ç–æ—á–∫–∏ (X Y): 1 0

–í–≤–µ–¥–∏—Ç–µ —Ç–æ—á–∫–∏ (X Y): 2 0.693

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –º–µ—Ç–æ–¥–∞ (linear):
–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ—á–∫–∏:
   1.000    1.500    2.000    2.500 
–ò–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
   0.000    0.346    0.693    1.039 

–í–≤–µ–¥–∏—Ç–µ —Ç–æ—á–∫–∏ (X Y): 3 1.0986

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –º–µ—Ç–æ–¥–∞ (linear):
–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ—á–∫–∏:
   2.000    2.500    3.000    3.500 
–ò–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
   0.693    0.896    1.099    1.301 

–í–≤–µ–¥–∏—Ç–µ —Ç–æ—á–∫–∏ (X Y): 4 1.386

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –º–µ—Ç–æ–¥–∞ (linear):
–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ—á–∫–∏:
   3.000    3.500    4.000    4.500 
–ò–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
   1.099    1.242    1.386    1.530 

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –º–µ—Ç–æ–¥–∞ (lagrange):
–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ—á–∫–∏:
   1.000    1.500    2.000    2.500    3.000    3.500    4.000    4.500 
–ò–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
   0.000    0.393    0.693    0.921    1.099    1.247    1.386    1.538 
```

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è OTP:

#### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã:
- –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É [lab3_gen_servers_app](lab3_gen_servers/src/lab3_gen_servers_app.erl)
- –°–µ—Ä–≤–µ—Ä –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö: [input_server](lab3_gen_servers/src/input_server.erl)
- –°–µ—Ä–≤–µ—Ä –≤—ã–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: [output_server](lab3_gen_servers/src/output_server.erl)
- –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç—ã —Å –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è–º–∏ [interpolation_server](lab3_gen_servers/src/interpolation_server.erl)
- –°–µ—Ä–≤–µ—Ä –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ª–∏–Ω–µ–π–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ [linear_server](lab3_gen_servers/src/linear_server.erl)
- –°–µ—Ä–≤–µ—Ä –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –ª–∞–≥—Ä–∞–Ω–∂–∞ [lagrange_server](lab3_gen_servers/src/lagrange_server.erl)

#### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:
–í —Ü–µ–ª–æ–º –∞–ª–≥–æ—Ä–∏—Ç–º —Å—Ö–æ–∂–∏–π —Å –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏, –Ω–æ –ø–æ–º–µ–Ω—è–ª–∞—Å—å –ª–æ–≥–∏–∫–∞ –æ–±—â–µ–Ω–∏—è –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã casts —É gen_servers, –∞ –æ–∂–∏–¥–∞–µ–º —á–µ—Ä–µ–∑ handlers

### –ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

**–õ–∏–Ω–µ–π–Ω–∞—è –∏–Ω–µ—Ä–ø–æ–ª—è—Ü–∏—è**

```erlang
start_link() ->
  gen_server:start_link({local, ?MODULE}, ?MODULE, [], []).

stop() ->
  gen_server:cast(?MODULE, stop).

%% Callbacks
init([]) ->
  {ok, []}.

handle_cast({linear, Input, Freq}, State) ->
  %% Add the new point to the state
  NewState =
    case length(State) of
      2 -> tl(State) ++ [Input];
      _ -> State ++ [Input]
    end,

  %% Perform interpolation if there are exactly two points
  NewState =
    case NewState of
      [P1, P2] ->
        Sorted = lists:sort(fun([A, _], [B, _]) -> A =< B end, [P1, P2]),
        Result = linear_interpolation(Freq, Sorted),
        case Result of
          {ok, linear, Res} ->
            gen_server:cast(interpolation_server, {ok, linear, Res}),
            NewState;
          {error, linear, Msg} ->
            gen_server:cast(interpolation_server, {error, linear, Msg}),
            NewState
        end;
      _ ->
        NewState
    end,

  {noreply, NewState};
handle_cast(stop, State) ->
  {stop, normal, State}.

handle_call(_, _From, State) ->
  {reply, ok, State}.
code_change(_OldVsn, State, _Extra) ->
  {ok, State}.
handle_info(_, State) ->
  {noreply, State}.

terminate(_Reason, _State) ->
  ok.

% Logic

linear_interpolation(Step, [[X1, Y1], [X2, Y2]]) ->
  case X1 =:= X2 of
    true ->
      {error, linear, "–ó–Ω–∞—á–µ–Ω–∏—è X —Å–æ–≤–ø–∞–¥–∞—é—Ç, –≤–≤–µ–¥–∏—Ç–µ –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ X"};
    false ->
      K = (Y2 - Y1) / (X2 - X1),
      B = Y1 - K * X1,
      GenerateValues = interpolation_server:points_generator(Step, X1, X2),
      Res = [GenerateValues, lists:map(fun(X) -> K * X + B end, GenerateValues)],
      {ok, linear, Res}
  end.
```

**–ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –õ–∞–≥—Ä–∞–Ω–∂–∞**

```erlang
start_link() ->
  gen_server:start_link({local, ?MODULE}, ?MODULE, [], []).

stop() ->
  gen_server:cast(?MODULE, stop).

init([]) ->
  {ok, []}.

handle_call(_, _From, State) ->
  {reply, ok, State}.

handle_cast(stop, State) ->
  {stop, normal, State};
handle_cast({lagrange, Input, Window, Freq}, State) ->
  UpdatedPoints =
    case length(State) of
      Window ->
        tl(State) ++ [Input];
      _ ->
        State ++ [Input]
    end,
  case length(UpdatedPoints) of
    Window ->
      Sorted = lists:sort(fun([A, _], [B, _]) -> A =< B end, UpdatedPoints),
      InterpolatedValues = evaluate_lagrange(Freq, Sorted),
      gen_server:cast(interpolation_server, {ok, lagrange, InterpolatedValues});
    _ ->
      ok
  end,
  {noreply, UpdatedPoints}.

handle_info(_, State) ->
  {noreply, State}.
terminate(_Reason, _State) ->
  ok.
code_change(_OldVsn, State, _Extra) ->
  {ok, State}.

% Lagrange multiplier
lagrange_multiplier(X, Xi, Points) ->
  lists:foldl(
    fun
      ([Xj, _], Acc) when Xj =/= Xi ->
        Acc * (X - Xj) / (Xi - Xj);
      (_, Acc) ->
        Acc
    end,
    1,
    Points
  ).

% Lagrange polynomial
lagrange_polynomial(X, Points) ->
  lists:foldl(
    fun([Xi, Yi], Acc) ->
      Acc + Yi * lagrange_multiplier(X, Xi, Points)
    end,
    0,
    Points
  ).

evaluate_lagrange(Step, Points) ->
  [X1, _] = hd(Points),
  [X2, _] = lists:last(Points),
  GeneratedDots = interpolation_server:points_generator(Step, X1, X2),
  [GeneratedDots, [lagrange_polynomial(X, Points) || X <- GeneratedDots]].
```

**–°–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è–º–∏:**

```erlang
start_link(InitialValues) ->
  gen_server:start_link({local, ?MODULE}, ?MODULE, [InitialValues], []).

stop() ->
  gen_server:cast(?MODULE, stop).

%% Callbacks
init([{Freq, Window}]) ->
  {ok, {Freq, Window}}.

handle_cast({interpolate, Input}, State) ->
  gen_server:cast(linear_server, {linear, Input, erlang:element(1, State)}),
  gen_server:cast(
    lagrange_server,
    {lagrange, Input, erlang:element(2, State), erlang:element(1, State)}
  ),
  {noreply, State};
handle_cast({ok, linear, Result}, State) ->
  gen_server:cast(output_server, {ok, linear, Result}),
  {noreply, State};
handle_cast({ok, lagrange, Result}, State) ->
  gen_server:cast(output_server, {ok, lagrange, Result}),
  {noreply, State};
handle_cast({error, Method, Msg}, State) ->
  gen_server:cast(output_server, {error, Method, Msg}),
  {noreply, State};
handle_cast(stop, State) ->
  {stop, normal, State}.

handle_call(_, _From, State) ->
  {reply, ok, State}.
code_change(_OldVsn, State, _Extra) ->
  {ok, State}.
handle_info(_, State) ->
  {noreply, State}.

terminate(_Reason, _State) ->
  ok.
```
### –í–≤–æ–¥/–í—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã:

–ù–∞–π–¥–µ–º —Ç–æ—á–∫–∏ –¥–ª—è –ª–∏–Ω–µ–π–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –∏ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –ª–∞–≥—Ä–∞–Ω–∂–∞, –≥–¥–µ:

- Frequency - 0.5
- Windows - 2

–î–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ ln(x):

```text
–í–≤–µ–¥–∏—Ç–µ —Ç–æ—á–∫–∏ (X Y): 1 0

–í–≤–µ–¥–∏—Ç–µ —Ç–æ—á–∫–∏ (X Y): 2 0.693

linear –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è: 
–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ—á–∫–∏:
   1.000    1.500    2.000    2.500 
–ò–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
   0.000    0.346    0.693    1.039 

lagrange –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è: 
–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ—á–∫–∏:
   1.000    1.500    2.000    2.500 
–ò–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
   0.000    0.347    0.693    1.039 

–í–≤–µ–¥–∏—Ç–µ —Ç–æ—á–∫–∏ (X Y): 

```

## –í—ã–≤–æ–¥

–í –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã —è –∏–∑—É—á–∏–ª –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤ Erlang, –∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞. –û–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —É–¥–∞–ª–æ—Å—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É—Å–ø–µ—à–Ω–æ, –æ–¥–Ω–∞–∫–æ —Ä–∞–±–æ—Ç–∞ —Å –æ–±—ã—á–Ω—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –æ–∫–∞–∑–∞–ª–∞—Å—å –Ω–µ–º–Ω–æ–≥–æ —Å–ª–æ–∂–Ω–µ–µ –∏–∑-–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é —É–ø—Ä–∞–≤–ª—è—Ç—å PID-–∞–º–∏ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–æ–±—â–µ–Ω–∏–π. –í —Ç–æ –∂–µ –≤—Ä–µ–º—è, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ OTP —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —É–ø—Ä–æ—â–∞–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏. –ë–ª–∞–≥–æ–¥–∞—Ä—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–º –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è–º, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π, –Ω–µ —Ç—Ä–µ–±—É—é—â–∏–π —è–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞–º–∏.

OTP –ø–æ–∫–∞–∑–∞–ª —Å–µ–±—è –∫–∞–∫ –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –≥–æ—Ç–æ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–ø—Ä–æ—â–∞—é—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∑–∞–¥–∞—á. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ –ª–æ–≥–∏–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –æ—Å—Ç–∞–≤–ª—è—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –≥–æ—Ç–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏–π. –û–¥–Ω–∞–∫–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±—ã—á–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –¥–∞–µ—Ç –±–æ–ª—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è —Ç–æ–Ω–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º –ø—Ä–∏ —Ä–µ—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ —Ç–∏–ø–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã OTP.